# **å®‰å…¨å³æ—¶é€šè®¯ç³»ç»Ÿ - 5æ—¥å†²åˆºå¼€å‘è®¡åˆ’**

æœ¬æ–‡æ¡£æ˜¯é¡¹ç›®çš„æ ¸å¿ƒæŒ‡å—ï¼Œè¯·æ‰€æœ‰æˆå‘˜æ¯æ—¥å‚ç…§æ­¤æ–‡æ¡£è¿›è¡Œå¼€å‘ã€‚

---

### **ğŸ¯ 5æ—¥å†²åˆºç›®æ ‡ (MVP - æœ€ä½å¯è¡Œäº§å“)**

æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åœ¨5å¤©å†…ï¼Œå®Œæˆä¸€ä¸ªå¯ä»¥æ¼”ç¤ºçš„æ ¸å¿ƒåŠŸèƒ½ç‰ˆæœ¬ã€‚**æ‰€æœ‰ä»»åŠ¡éƒ½åº”å›´ç»•ä»¥ä¸‹MVPå±•å¼€**ï¼š

1.  **ç”¨æˆ·ç³»ç»Ÿ:** ç”¨æˆ·å¯ä»¥æˆåŠŸ **æ³¨å†Œ** å’Œ **ç™»å½•**ã€‚
2.  **å¥½å‹åˆ—è¡¨:** ç™»å½•åï¼Œå¯ä»¥çœ‹åˆ° **åœ¨çº¿çš„å¥½å‹**ã€‚
3.  **å®æ—¶èŠå¤©:** å¯ä»¥ä¸åœ¨çº¿å¥½å‹è¿›è¡Œ **1å¯¹1çš„å®æ—¶æ–‡æœ¬èŠå¤©**ã€‚
4.  **å®‰å…¨æ€§:** èŠå¤©å†…å®¹ç»è¿‡ **ç«¯åˆ°ç«¯åŠ å¯†**ã€‚

*æ³¨æ„ï¼šä¿¡æ¯éšè—ã€è¯­éŸ³èŠå¤©ã€å¤´åƒç­‰åŠŸèƒ½å‡ä¸ºåŠ åˆ†é¡¹ï¼Œåœ¨å®ŒæˆMVPåè‹¥æœ‰æ—¶é—´å†è€ƒè™‘ã€‚*

---

### **ğŸ› ï¸ æŠ€æœ¯æ ˆ**

*   **åç«¯:** Python, **FastAPI**, Uvicorn, `python-jose` (ç”¨äºJWTè®¤è¯)
*   **å‰ç«¯:** **uniapp** (Vue 3), **Element Plus** (ä»…ç”¨äºH5ç«¯), Pinia
*   **å®æ—¶é€šä¿¡:** **WebSockets** (ç”¨äºä¿¡ä»¤), **WebRTC** (ç”¨äºP2Pæ•°æ®)
*   **æ•°æ®åº“:** SQLite

---

### **ğŸš€ å¿«é€Ÿå¯åŠ¨æŒ‡å—**

**åç«¯:**
```bash
# 1. è¿›å…¥åç«¯ç›®å½•
cd backend

# 2. å®‰è£…ä¾èµ–
pip install -r ../requirements.txt

# 3. å¯åŠ¨æœåŠ¡å™¨ (å¼€å‘æ¨¡å¼ï¼Œè‡ªåŠ¨é‡è½½)
uvicorn server:app --reload
```
> æœåŠ¡å™¨è¿è¡Œåœ¨ `http://127.0.0.1:8000`

**å‰ç«¯ (uniapp):**
```bash
# 1. è¿›å…¥å‰ç«¯ç›®å½•
cd frontend

# 2. å®‰è£…ä¾èµ–
npm install

# 3. ä»¥H5æ¨¡å¼å¯åŠ¨å¼€å‘æœåŠ¡å™¨ (ç”¨äºWebæµè§ˆå™¨é¢„è§ˆ)
npm run dev:h5
```
> å‰ç«¯å¼€å‘æœåŠ¡å™¨è¿è¡Œåœ¨ `http://localhost:5173` (æˆ–ç±»ä¼¼åœ°å€)

---

### **âœ… ä»»åŠ¡æ¸…å• (To-Do List)**

#### **åç«¯ä»»åŠ¡ (ç”±åç«¯åŒå­¦è´Ÿè´£)**

- [ ] **Day 1: åŸºç¡€æ­å»º**
    - [ ] åˆå§‹åŒ–FastAPIé¡¹ç›®ã€‚
    - [ ] è®¾è®¡å¹¶åˆ›å»ºSQLiteæ•°æ®åº“è¡¨ (`users`, `friends`)ã€‚
    - [ ] ç¼–å†™Pydanticæ¨¡å‹ç”¨äºæ•°æ®æ ¡éªŒ (`UserCreate`, `UserLogin`)ã€‚

- [ ] **Day 2: ç”¨æˆ·è®¤è¯**
    - [ ] å®ç°ç”¨æˆ·æ³¨å†ŒAPIæ¥å£ (`/register`)ã€‚
    - [ ] å®ç°ç”¨æˆ·ç™»å½•APIæ¥å£ (`/login`)ï¼ŒæˆåŠŸåè¿”å›JWT Tokenã€‚
    - [ ] å®ç°ä¸€ä¸ªéœ€è¦JWTè®¤è¯çš„æµ‹è¯•æ¥å£ï¼Œä»¥éªŒè¯Tokenæœ‰æ•ˆæ€§ã€‚

- [ ] **Day 3: WebSocketè¿æ¥ç®¡ç†**
    - [ ] åˆ›å»ºä¸€ä¸ªWebSocketç«¯ç‚¹ (`/ws/{token}`) ç”¨äºæ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ã€‚
    - [ ] å®ç°ä¸€ä¸ª`ConnectionManager`ç±»ï¼Œç”¨äºç®¡ç†æ‰€æœ‰æ´»è·ƒçš„WebSocketè¿æ¥ã€‚
    - [ ] ç”¨æˆ·é€šè¿‡WebSocketè¿æ¥åï¼Œè§£æTokenï¼Œæ ‡è®°ç”¨æˆ·ä¸ºåœ¨çº¿ï¼Œå¹¶å°†å…¶è¿æ¥å­˜å…¥ç®¡ç†å™¨ã€‚
    - [ ] å½“ç”¨æˆ·æ–­å¼€è¿æ¥æ—¶ï¼Œå°†å…¶ä»ç®¡ç†å™¨ä¸­ç§»é™¤ã€‚

- [ ] **Day 4: WebRTCä¿¡ä»¤ä¸å¥½å‹é€»è¾‘**
    - [ ] å®ç°å¥½å‹åˆ—è¡¨æ¥å£ (`/friends`)ï¼Œè¿”å›å½“å‰ç”¨æˆ·çš„å¥½å‹åŠå…¶åœ¨çº¿çŠ¶æ€ã€‚
    - [ ] åœ¨WebSocketä¸­å®ç°WebRTCä¿¡ä»¤è½¬å‘é€»è¾‘ (offer, answer, ice-candidate)ã€‚
    - [ ] å®ç°æ·»åŠ å¥½å‹çš„æ¥å£ã€‚

- [ ] **Day 5: è”è°ƒä¸æ”¶å°¾**
    - [ ] ä¸å‰ç«¯è¿›è¡Œå¯†é›†è”è°ƒï¼Œä¿®å¤BUGã€‚
    - [ ] ç¡®ä¿æ‰€æœ‰APIå’ŒWebSocketæ¶ˆæ¯æ ¼å¼ä¸å‰ç«¯çº¦å®šä¸€è‡´ã€‚
    - [ ] æ•´ç†ä»£ç ï¼Œæ·»åŠ å¿…è¦çš„æ³¨é‡Šã€‚

#### **å‰ç«¯ä»»åŠ¡ (uniapp - ç”±å‰ç«¯åŒå­¦åˆ†å·¥åä½œ)**

- [ ] **Day 1: é¡¹ç›®æ­å»ºä¸ç™»å½•é¡µ**
    - [ ] **å®‰è£…ä¾èµ–:** `npm install element-plus pinia axios`
    - [ ] **é…ç½® `main.js`:** å¼•å…¥å¹¶æ³¨å†Œ `Pinia`ã€‚
    - [ ] **é…ç½® `vite.config.js`:** æŒ‰éœ€å¼•å…¥ `Element Plus` ä»¥å‡å°æ‰“åŒ…ä½“ç§¯ã€‚
    - [ ] **é¡µé¢ä¸è·¯ç”±:** åœ¨ `src/pages.json` ä¸­é…ç½®ç™»å½•é¡µå’ŒèŠå¤©ä¸»é¡µçš„è·¯å¾„ã€‚
    - [ ] **çŠ¶æ€ç®¡ç†:** åˆ›å»ºPinia store (`src/store/auth.js`) ç”¨äºç®¡ç†ç”¨æˆ·Tokenã€‚
    - [ ] **UIå¼€å‘:** åœ¨ `src/pages/login/login.vue` ä¸­ï¼Œä½¿ç”¨ `Element Plus` ç»„ä»¶å®Œæˆç™»å½•/æ³¨å†Œé¡µé¢çš„UIå¸ƒå±€ã€‚

- [ ] **Day 2: å®ç°ç™»å½•é€»è¾‘**
    - [ ] **APIæœåŠ¡:** åœ¨ `src/services/api.js` ä¸­ï¼Œä½¿ç”¨ `axios` ç¼–å†™è°ƒç”¨åç«¯æ³¨å†Œ/ç™»å½•æ¥å£çš„å‡½æ•°ã€‚
    - [ ] **ç™»å½•æµç¨‹:** å®ç°å®Œæ•´çš„ç™»å½•æµç¨‹ï¼šè°ƒç”¨API -> è·å–Token -> å­˜å…¥Piniaå’Œ`uni.setStorageSync` -> ä½¿ç”¨ `uni.reLaunch` è·³è½¬åˆ°èŠå¤©é¡µã€‚
    - [ ] **è·¯ç”±æ‹¦æˆª:** åœ¨ `src/main.js` æˆ–å•ç‹¬çš„æ‹¦æˆªå™¨æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨ `uni.addInterceptor` å®ç°è·¯ç”±å®ˆå«ï¼Œæœªç™»å½•ç”¨æˆ·è®¿é—®èŠå¤©é¡µæ—¶è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µã€‚

- [ ] **Day 3: èŠå¤©ä¸»ç•Œé¢ä¸WebSocket**
    - [ ] **UIå¼€å‘:** æ­å»ºèŠå¤©ä¸»ç•Œé¢UI (`src/pages/chat/chat.vue`)ï¼ŒåŒ…æ‹¬å¥½å‹åˆ—è¡¨å’ŒèŠå¤©çª—å£åŒºåŸŸã€‚
    - [ ] **WebSocketæœåŠ¡:** å°è£… `uni.connectSocket`ï¼Œåœ¨è¿›å…¥èŠå¤©é¡µåè‡ªåŠ¨è¿æ¥åç«¯WebSocketã€‚
    - [ ] **æ•°æ®æ¸²æŸ“:** ä»åç«¯è·å–å¥½å‹åˆ—è¡¨å¹¶æ¸²æŸ“åˆ°ç•Œé¢ä¸Šï¼ŒåŒºåˆ†åœ¨çº¿çŠ¶æ€ã€‚

- [ ] **Day 4: WebRTCå®ç°**
    - [ ] **WebRTCæœåŠ¡:** ç¼–å†™WebRTCå¤„ç†å™¨ï¼Œå°è£…åˆ›å»ºè¿æ¥ã€å¤„ç†ä¿¡ä»¤çš„é€»è¾‘ã€‚
    - [ ] **ä¿¡ä»¤äº¤äº’:** å®ç°ç‚¹å‡»å¥½å‹åï¼Œé€šè¿‡WebSocketä¿¡ä»¤ä¸å¯¹æ–¹å»ºç«‹WebRTCè¿æ¥çš„å®Œæ•´æµç¨‹ã€‚
    - [ ] **æ•°æ®é€šé“:** å®ç°é€šè¿‡WebRTC DataChannelå‘é€å’Œæ¥æ”¶æ–‡æœ¬æ¶ˆæ¯ã€‚

- [ ] **Day 5: è”è°ƒä¸æ”¶å°¾**
    - [ ] **æ¶ˆæ¯æ˜¾ç¤º:** å°†æ”¶åˆ°çš„æ¶ˆæ¯æ˜¾ç¤ºåœ¨èŠå¤©çª—å£ä¸­ã€‚
    - [ ] **ç«¯åˆ°ç«¯åŠ å¯†:** åœ¨å‘é€æ¶ˆæ¯å‰åŠ å¯†ï¼Œåœ¨æ”¶åˆ°æ¶ˆæ¯åè§£å¯† (ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿ`SubtleCrypto` API)ã€‚
    - [ ] **ä½“éªŒä¼˜åŒ–:** æ•´ä½“UI/UXä¼˜åŒ–å’ŒBUGä¿®å¤ã€‚

---

### **ğŸ“¡ æ ¸å¿ƒé€šä¿¡åè®®**

**WebSocketæ¶ˆæ¯æ ¼å¼ (JSON):**
```json
{
  "type": "event_name",
  "payload": { ... }
}
```
**ç¤ºä¾‹:**
*   **Aå‘Bå‘èµ·é€šè¯è¯·æ±‚ (A -> Server -> B):**
    `{"type": "webrtc-offer", "payload": {"sdp": ..., "target_user": "B"}}`
*   **Bå›åº”A (B -> Server -> A):**
    `{"type": "webrtc-answer", "payload": {"sdp": ..., "target_user": "A"}}`
*   **äº¤æ¢ICEå€™é€‰ (A <-> Server <-> B):**
    `{"type": "webrtc-ice-candidate", "payload": {"candidate": ..., "target_user": "..."}}`

---


